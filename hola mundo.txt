#include <LiquidCrystal.h>         
#include <Keypad.h>
int a=0, b=0, c=0, d=0;//acumuladores de datos enteros para la contrseña.
int var=0; //incremento para el switch.

int PW1=1,PW2=2,PW3=3,PW4=4;// Silvia
int PW5=1,PW6=2,PW7=3,PW8=5;//Paul
int PW9=1,PW10=3,PW11=5,PW12=7;//Linda
int PW13=2,PW14=4,PW15=6,PW16=8;//Rosemary
int PW17=9,PW18=8,PW19=7,PW20=6;//Benito
int PW21=4,PW22=3,PW23=2,PW24=1;//Marlene

char f='*';

//e=Decena de Hora g=Unidad de hora h=Decena de Minutos i=Unidad de Minutos
int e=0, g=0, h=0, i=0;


int veces=0,incorrecto=0; //3 intentos para ingresar la contraseña correcta.
int aviso=3; //aviso para mostrar los intentos al usuario.
const byte filas = 4; 
const byte columnas = 4; 
char tecla[filas][columnas] = {
  {'1','2','3','A'},
  {'4','5','6','B'},
  {'7','8','9','C'},
  {'*','0','#','D'}
};

byte pinFilas[filas] = {7, 6, 5, 4}; //conexión pines de filas
byte pinColumnas[columnas] = {3, 2, A4, A5};// conexión pines columnas

Keypad keypad = Keypad( makeKeymap(tecla), pinFilas, pinColumnas, filas, columnas );
LiquidCrystal lcd(13,12,11,10,9,8); //RS,E,D4,D5,D6,D7
void setup(){
  lcd.begin(16,2); //LCD (16 COLUMNAS Y 2 FILAS)
}
void loop(){
  char key = keypad.getKey();
  if (key){
   lcd.setCursor(5+var,1);
   lcd.print(key),lcd.setCursor(5+var,1);//imprimimos el caracter en el lcd
   key=key-48; //COVERSIÓN DE CHAR A ENTEROS -48 SEGUN EL CÓDIGO ASCII.
   var++; //var se incrementa para los case1,case2,case3,case4.
   
    
    //switch para cada caso de las variables
    switch(var){
      case 1:
      a=key;//almacenamos primer dígito para la contraseña que seria el 1
      lcd.print(f);
      break;
      case 2:
      b=key;
      lcd.print(f);
      break;
      case 3:
      c=key;
      lcd.print(f);
      break;
      case 4:
      d=key; 
      lcd.print(f);
      lcd.clear();
      lcd.print("¿Que hora es?");
      delay(1000);
      lcd.clear();
      break;
      case 5:
      e=key; 
      break;
      case 6:
      g=key;
      break;
      case 7:
      lcd.print(':');
      break;
      case 8:
      h=key;
       break;
      case 9:
      i=key;
      
      if(a==PW1 && b==PW2 && c==PW3 && d==PW4 ){
       if(g==9 && h<=3 ){
    
    lcd.clear();
    lcd.setCursor(5,0);
    lcd.print("Clave");
    lcd.setCursor(4,1);
    lcd.print("Correcta");
    digitalWrite(A0,HIGH);
    delay(1000);
    lcd.clear();
    digitalWrite(A0,LOW);
    lcd.print("Bienvenida");
    lcd.setCursor(4,1);
    lcd.print("Silvia");
    digitalWrite(A0,HIGH);
    delay(2000);
    lcd.clear();
    digitalWrite(A0,LOW);
       }else{
        lcd.clear();
    lcd.setCursor(6,0);
    lcd.print("Horario");
    lcd.setCursor(3,1);
    lcd.print("Incorrecto");
    digitalWrite(A1,HIGH);
    delay(1000);
    lcd.clear();
    digitalWrite(A1,LOW);
       }
  
  }
     else if(a==PW5 && b==PW6 && c==PW7 && d==PW8){
      if(g==9 && h<=3 ){
      lcd.clear();
      lcd.setCursor(5,0);
      lcd.print("Clave");
      lcd.setCursor(4,1);
      lcd.print("Correcta");
      digitalWrite(A0,HIGH);
      delay(1000);
      lcd.clear();
      digitalWrite(A0,LOW);
      lcd.print("Bienvenido");
      lcd.setCursor(4,1);
      lcd.print("Paul");
      digitalWrite(A0,HIGH);
      delay(2000);
      lcd.clear();
      digitalWrite(A0,LOW);
      }else{
          lcd.clear();
      lcd.setCursor(6,0);
      lcd.print("Horario");
      lcd.setCursor(3,1);
      lcd.print("Incorrecto");
      digitalWrite(A1,HIGH);
      delay(1000);
      lcd.clear();
      digitalWrite(A1,LOW);
         }
  }
     else if(a==PW9 && b==PW10 && c==PW11 && d==PW12){
      if(g==9 && h>=2 && h<=5 ){
      lcd.clear();
      lcd.setCursor(5,0);
      lcd.print("Clave");
      lcd.setCursor(4,1);
      lcd.print("Correcta");
      digitalWrite(A0,HIGH);
      delay(1000);
      lcd.clear();
      digitalWrite(A0,LOW);
      lcd.print("Bienvenida");
      lcd.setCursor(4,1);
      lcd.print("Linda");
      digitalWrite(A0,HIGH);
      delay(2000);
      lcd.clear();
      digitalWrite(A0,LOW);
        }else{
          lcd.clear();
      lcd.setCursor(6,0);
      lcd.print("Horario");
      lcd.setCursor(3,1);
      lcd.print("Incorrecto");
      digitalWrite(A1,HIGH);
      delay(1000);
      lcd.clear();
      digitalWrite(A1,LOW);
         }
    
  }
     else if(a==PW13 && b==PW14 && c==PW15 && d==PW16){
        if(g==9 && h>=2 && h<=5 ){
      lcd.clear();
      lcd.setCursor(5,0);
      lcd.print("Clave");
      lcd.setCursor(4,1);
      lcd.print("Correcta");
      digitalWrite(A0,HIGH);
      delay(1000);
      lcd.clear();
      digitalWrite(A0,LOW);
      lcd.print("Bienvenida");
      lcd.setCursor(4,1);
      lcd.print("Rosemary");
      digitalWrite(A0,HIGH);
      delay(2000);
      lcd.clear();
      digitalWrite(A0,LOW);
        }else{
          lcd.clear();
      lcd.setCursor(6,0);
      lcd.print("Horario");
      lcd.setCursor(3,1);
      lcd.print("Incorrecto");
      digitalWrite(A1,HIGH);
      delay(1000);
      lcd.clear();
      digitalWrite(A1,LOW);
         }
    
  }
     else if(a==PW17 && b==PW18 && c==PW19 && d==PW20){
       if(g==9 && h>=4 && i>=5){
      lcd.clear();
      lcd.setCursor(5,0);
      lcd.print("Clave");
      lcd.setCursor(4,1);
      lcd.print("Correcta");
      digitalWrite(A0,HIGH);
      delay(1000);
      lcd.clear();
      digitalWrite(A0,LOW);
      lcd.print("Bienvenido");
      lcd.setCursor(4,1);
      lcd.print("Benito");
      digitalWrite(A0,HIGH);
      delay(2000);
      lcd.clear();
      digitalWrite(A0,LOW);
       }
      else if(e==1 && g==0 && h<=1 && i<=5  ){
      lcd.clear();
      lcd.setCursor(5,0);
      lcd.print("Clave");
      lcd.setCursor(4,1);
      lcd.print("Correcta");
      digitalWrite(A0,HIGH);
      delay(1000);
      lcd.clear();
      digitalWrite(A0,LOW);
      lcd.print("Bienvenido");
      lcd.setCursor(4,1);
      lcd.print("Benito");
      digitalWrite(A0,HIGH);
      delay(2000);
      lcd.clear();
      digitalWrite(A0,LOW);
        }else{
          lcd.clear();
      lcd.setCursor(6,0);
      lcd.print("Horario");
      lcd.setCursor(3,1);
      lcd.print("Incorrecto");
      digitalWrite(A1,HIGH);
      delay(1000);
      lcd.clear();
      digitalWrite(A1,LOW);
         }
    
  }
     else if(a==PW21 && b==PW22 && c==PW23 && d==PW24){
      if(g==9 && h>=4 && i>=5){
      lcd.clear();
      lcd.setCursor(5,0);
      lcd.print("Clave");
      lcd.setCursor(4,1);
      lcd.print("Correcta");
      digitalWrite(A0,HIGH);
      delay(1000);
      lcd.clear();
      digitalWrite(A0,LOW);
      lcd.print("Bienvenida");
      lcd.setCursor(4,1);
      lcd.print("Marlene");
      digitalWrite(A0,HIGH);
      delay(2000);
      lcd.clear();
      digitalWrite(A0,LOW);
        }
      else if(e==1 && g==0 && h<=1 && i<=5  ){
      lcd.clear();
      lcd.setCursor(5,0);
      lcd.print("Clave");
      lcd.setCursor(4,1);
      lcd.print("Correcta");
      digitalWrite(A0,HIGH);
      delay(1000);
      lcd.clear();
      digitalWrite(A0,LOW);
      lcd.print("Bienvenida");
      lcd.setCursor(4,1);
      lcd.print("Marlene");
      digitalWrite(A0,HIGH);
      delay(2000);
      lcd.clear();
      digitalWrite(A0,LOW);
      }else{
          lcd.clear();
      lcd.setCursor(6,0);
      lcd.print("Horario");
      lcd.setCursor(3,1);
      lcd.print("Incorrecto");
      digitalWrite(A1,HIGH);
      delay(1000);
      lcd.clear();
      digitalWrite(A1,LOW);
         }
    
  }
   
    else{
    lcd.clear();
    lcd.setCursor(6,0);
    lcd.print("Clave");
    lcd.setCursor(3,1);
    lcd.print("Incorrecta");
    digitalWrite(A1,HIGH);
    delay(1000);
    lcd.clear();
    digitalWrite(A1,LOW);
    }
     
//------Seguridad para la contraseña y sus restricciones-------------------//

  if(a==PW1 && b==PW2 && c==PW3 && d==PW4
     ||a==PW5 && b==PW6 && c==PW7 && d==PW8
     ||a==PW9 && b==PW10 && c==PW11 && d==PW12
     ||a==PW13 && b==PW14 && c==PW15 && d==PW16
     ||a==PW17 && b==PW18 && c==PW19 && d==PW20
     ||a==PW21 && b==PW22 && c==PW23 && d==PW24
    ){
      veces=0;//si es correcto el password , la variable veces no se incremeta.
      aviso=3;//variable aviso se mantiene en 3
    }
  else{
      veces ++; //incrementamos los intentos incorrectos de password para el bloqueo.
      aviso --; //decremento de variable aviso ,de 3 hasta 0 según las veces de fallas al ingresar el password.
      lcd.setCursor(2,0);
      lcd.print("LE QUEDA: ");
      lcd.setCursor(13,0);
      lcd.print(aviso);
      lcd.setCursor(2,1);
      lcd.print("OPORTUNIDAD");
       if(aviso==0){
          lcd.clear();
          lcd.setCursor(5,0);
          lcd.print("ALARMA");
          lcd.setCursor(4,1);
          lcd.print("ACTIVADA");
        }
      delay(1000);lcd.clear();
      }

  while(veces>=3){
      lcd.setCursor(1,0),lcd.print("Alerta Policia");
      lcd.setCursor(4,1),lcd.print("Intrusos");
      digitalWrite(A1,HIGH);
      delay(1000);
      lcd.clear();
      digitalWrite(A1,LOW);delay(50);
  }//while es Bucle infinito de seguridad para bloquear los re intentos del password

   var=0;
   lcd.clear();

  break;//se  termina 
  }

 }
 if(!key){
   lcd.setCursor(0,0),lcd.print("Ingresar");
   
  
 }//portada de inicio en el LCD

  delay(2);
}


